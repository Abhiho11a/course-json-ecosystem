# This is a basic workflow to help you get started with Actions
name: CI
# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:
# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  label_previous_prs:
    runs-on: ubuntu-latest
    steps:
      - name: Label previously merged PRs
        env:
          GITHUB_TOKEN: ${{ secrets.PAT }}
        run: |
          merged_prs=$(curl -s -H "Authorization: token $GITHUB_TOKEN" \
            "https://api.github.com/repos/${{ github.repository }}/pulls?state=closed&per_page=100")
          for pr_number in $(echo "$merged_prs" | jq '.[] | select(.merged_at != null) | .number'); do
            echo "Adding label to PR #$pr_number"
            curl -s -H "Authorization: token $GITHUB_TOKEN" \
              -X POST \
              -H "Accept: application/vnd.github.v3+json" \
              https://api.github.com/repos/${{ github.repository }}/issues/$pr_number/labels \
              -d '{"labels":["hacktoberfest-accepted"]}'
          done
